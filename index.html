<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RPG Quest Board — ver.08 + Sync + Rule UI (final)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3b2908">
<script>
if ('serviceWorker' in navigator) {
  addEventListener('load', ()=>navigator.serviceWorker.register('./service-worker.js').catch(()=>{}));
}
</script>
<style>
:root{
  --bg1:#7a4a0c; --bg2:#3b2908; --ink:#f9f4e8; --border:rgba(248,235,197,.25);
  --paper:#f4e4c1; --paper-ink:#2f2616; --searchbg: rgba(255,255,255,.06);
  --muted:#cbb98f; --expText:#cbb98f; --page-bg:linear-gradient(135deg,var(--bg1),var(--bg2));
}
*{box-sizing:border-box}
body{margin:0;background:var(--page-bg);color:var(--ink);font:14px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans JP',sans-serif}
header{position:sticky;top:0;background:rgba(35,26,9,.75);backdrop-filter:blur(6px);border-bottom:1px solid var(--border);z-index:40}
.wrap{max-width:1120px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;gap:10px}
h1{font-size:18px;margin:0;font-weight:800}
.btn{appearance:none;border:1px solid var(--border);background:var(--searchbg);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn:hover{background:rgba(255,255,255,.12)}
.btn.small{padding:6px 10px;font-size:12px;border-radius:9px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.col{display:flex;flex-direction:column;gap:12px}
.sp{flex:1}
main{max-width:1120px;margin:0 auto;padding:16px}
.grid{display:grid;grid-template-columns:1fr;gap:16px}
@media(min-width:980px){.grid{grid-template-columns:1fr 2fr}}
.card{background:rgba(0,0,0,.18);border:1px solid var(--border);border-radius:16px;overflow:hidden}
.card h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--border);font-size:15px}
.content{padding:12px 14px}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--searchbg);color:var(--ink)}
select option{color:#000;background:#fff}
textarea{min-height:72px;resize:vertical}
.pill{display:inline-flex;gap:6px;align-items:center;padding:4px 10px;border-radius:999px;background:var(--searchbg);border:1px solid var(--border)}
.badge{display:inline-flex;gap:6px;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px}
.b-exptext{background:var(--searchbg);color:var(--expText)}
.muted{color:var(--muted)}
.progress{height:8px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden}
.progress>i{display:block;height:100%;background:linear-gradient(90deg,#e9b161,#e9d861)}
.tabs{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.tab{padding:6px 8px;text-align:center;border:1px solid var(--border);border-radius:999px;background:var(--searchbg);cursor:pointer;font-size:12px}
.tab.active{background:rgba(255,255,255,.16)}
.search{position:relative}
.search input{padding-left:30px}
.search:before{content:'🔎';position:absolute;left:8px;top:50%;transform:translateY(-50%);opacity:.7}
.list{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:620px){.list{grid-template-columns:1fr 1fr}}
.quest{background:var(--paper);color:var(--paper-ink);border:1px solid #e5d7ae;border-radius:12px;padding:10px 10px 44px;position:relative;box-shadow:0 8px 18px rgba(0,0,0,.18)}
.quest h3{margin:0 0 6px 0;font-size:15px;color:#2a1f0e}
.desc{color:#443418}
.unlocks{color:#5a4828;font-size:13px;margin-top:4px}
.box{background:#dbcaa6;border:1px solid var(--border);border-radius:10px;padding:6px 10px;display:inline-flex;align-items:center;gap:6px}
.quest .fixedActions{position:absolute;left:10px;bottom:8px;display:flex;gap:8px;align-items:center}
.quest .editBar{position:absolute;right:10px;bottom:8px;display:none;gap:8px}
.quest.edit .editBar{display:flex}
/* Drawer */
.drawer{position:fixed;inset:0;display:none;z-index:50}
.drawer.open{display:block}
.drawer .panel{position:absolute;inset:0 35% 0 0;background:#1c1407;border-right:1px solid var(--border);overflow:auto}
@media(max-width:980px){.drawer .panel{inset:0;max-width:480px}}
.drawer .shade{position:absolute;inset:0;background:rgba(0,0,0,.35)}
.ruleBox{border:1px solid var(--border);border-radius:12px;padding:12px;margin-top:8px}
.ruleGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:640px){.ruleGrid{grid-template-columns:1fr}}
/* Status big tiles */
.statTiles{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.statTile{padding:14px;border:1px solid var(--border);border-radius:12px;background:rgba(255,255,255,.06);text-align:center;font-weight:800;font-size:16px}
/* Sync panel */
#syncFloat{position:fixed;right:12px;bottom:12px;z-index:9999;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);color:#fff;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:8px 10px;display:flex;gap:8px;align-items:center;font:12px/1.3 system-ui,sans-serif}
#syncFloat button{appearance:none;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:#fff;border-radius:8px;padding:6px 8px;cursor:pointer}
#syncFloat button:hover{background:rgba(255,255,255,.12)}
#syncFloat .dot{width:8px;height:8px;border-radius:50%;background:#aaa}
#syncFloat .dot.on{background:#54d38a}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <button id="adminBtn" class="btn">☰</button>
    <h1>RPG Quest Board</h1>
    <div class="sp"></div>
    <button id="toggleEdit" class="btn">編集モード: OFF</button>
    <button id="resetBtn" class="btn">初期化</button>
  </div>
</header>

<!-- Admin Drawer (Add/Edit) -->
<div id="adminDrawer" class="drawer">
  <div class="shade" data-close></div>
  <div class="panel">
    <div class="wrap" style="padding:10px;border-bottom:1px solid var(--border)">
      <div style="font-weight:600">クエスト追加 / 編集</div>
      <div class="sp"></div><button class="btn" data-close>閉じる</button>
    </div>
    <div style="padding:12px" class="col">
      <div class="card">
        <h2 id="formTitle">クエスト追加</h2>
        <div class="content col">
          <input id="qTitle" placeholder="タイトル（例: 本を30分読む）">
          <textarea id="qDesc" placeholder="説明（任意）"></textarea>
          <input id="qCategory" placeholder="カテゴリ（任意：例 知識/運動 など）">
          <div class="row">
            <select id="qDiff" style="max-width:160px">
              <option value="EASY">EASY</option>
              <option value="NORMAL" selected>NORMAL</option>
              <option value="HARD">HARD</option>
            </select>
            <span class="pill">獲得XP</span><input type="number" id="qExp" value="50" style="max-width:120px">
            <span class="pill">獲得G</span><input type="number" id="qGold" value="20" style="max-width:120px">
          </div>

          <div class="row">
            <label class="pill"><input type="radio" name="repeatType" value="REPEAT" checked> 反復クエスト</label>
            <label class="pill"><input type="radio" name="repeatType" value="SINGLE"> 単発クエスト</label>
          </div>

          <div class="ruleBox">
            <div class="row" style="justify-content:space-between">
              <strong>解放ルール（任意）</strong>
              <label class="row" style="gap:6px"><input type="checkbox" id="qHideCond"> 条件を隠す</label>
            </div>

            <!-- 共通: 必要クリア回数 + 種類 -->
            <div class="ruleGrid">
              <div>
                <div class="muted">必要クリア回数</div>
                <input type="number" id="ruleCount" value="5">
              </div>
              <div>
                <div class="muted">種類</div>
                <select id="ruleType">
                  <option value="NONE" selected>ルールなし</option>
                  <option value="STAT_UP">ステータス上昇</option>
                  <option value="UNLOCK_SKILL">スキル開放</option>
                  <option value="UNLOCK_JOB">職業開放</option>
                </select>
              </div>
            </div>

            <!-- レイアウト：STAT_UP -->
            <div id="ruleStat" class="col" style="display:none">
              <div class="ruleGrid">
                <div>
                  <div class="muted">ステータス</div>
                  <select id="statTarget">
                    <option value="HP">体力(HP)</option>
                    <option value="STR">筋力(STR)</option>
                    <option value="DEX">敏捷(DEX)</option>
                    <option value="INT">知力(INT)</option>
                    <option value="VIT">活力(VIT)</option>
                    <option value="LUK">運(LUK)</option>
                  </select>
                </div>
                <div>
                  <div class="muted">増加量</div>
                  <input type="number" id="statAmount" value="1">
                </div>
              </div>
              <div class="row">
                <label class="pill"><input type="radio" name="repeatMode" value="each" checked> しきい値ごと（例：3回ごとに上昇）</label>
                <label class="pill"><input type="radio" name="repeatMode" value="once"> 一度だけ（例：最初の3回達成時のみ）</label>
              </div>
            </div>

            <!-- レイアウト：SKILL -->
            <div id="ruleSkill" class="ruleGrid" style="display:none">
              <div>
                <div class="muted">スキルID</div>
                <input id="skillId" placeholder="任意のID">
              </div>
              <div>
                <div class="muted">スキル名</div>
                <input id="skillName" placeholder="スキル名">
              </div>
            </div>

            <!-- レイアウト：JOB -->
            <div id="ruleJob" class="ruleGrid" style="display:none">
              <div>
                <div class="muted">職業ID</div>
                <input id="jobId" placeholder="任意のID">
              </div>
              <div>
                <div class="muted">職業名</div>
                <input id="jobName" placeholder="職業名">
              </div>
            </div>
          </div>

          <div class="row">
            <button id="addQuestBtn" class="btn">掲示板に貼る</button>
            <button id="cancelEditBtn" class="btn" style="display:none">編集をキャンセル</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 以下はクエスト掲示板/ステータス表示・JS部分（省略せず続く） -->
<!-- ... -->
</body>
</html>
